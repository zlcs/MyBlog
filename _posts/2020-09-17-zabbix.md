---
layout: post
title:  zabbix5.0.3  编译安装详解
date: 2020-09-17
tags: zabbix
---

        
### zabbix简介


&emsp;&emsp;zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。

zabbix能监视各种网络参数，保证服务器系统的安全运营;并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。

zabbix由2部分构成，zabbix server与可选组件zabbix agent。

zabbix server可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，

它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD，Open BSD，OS X等平台上。


### 运行环境

```
centos 7.8
php 7.2
nginx 1.18.0
mysql 5.6
主机1:192.168.0.21
主机2:192.168.0.22
``` 

### 部署

**1.主机名

主机1
``` 
hostnamectl set-hostname zabbixserver1
``` 

主机2
``` 
hostnamectl set-hostname zabbixagent
``` 

**2.时间
``` 
yum install ntp -y  
systemctl enable ntpd
sudo vi /etc/sysconfig/ntpd  修改启动参数，增加-g -x参数，允许ntp服务在系统时间误差较大时也能正常工作 
sudo service ntpd restart
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  将系统时区改为上海时间 (亦即CST时区) 
``` 
执行date命令即可。 查看时间是否正确 
``` 
ntpdate -u cn.pool.ntp.org 手动更新时间
``` 

**3.安装宝塔面板
``` 
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
``` 

图：
记录访问地址及账号密码信息
``` 
外网面板地址: http://116.7.74.186:8888/7b5b2352
内网面板地址: http://192.168.0.21:8888/7b5b2352
username: b3td7ylh
password: 3d4a3fc5
``` 
图：
登录
图：
同时安装nginx php7.2+ mysql5.6 phpadmin，这里或者安装lnmp，如果是配置精简的服务器，建议单独安装nginx php mysql环境
图：
添加网站
图：
添加mysql用户
``` 
账号：zabbix
密码：zabbix
``` 
php参数
``` 
max_input_time 300
putenv()
``` 
**4.安装zabix
下载安装包
``` 
wget https://cdn.zabbix.com/zabbix/sources/stable/5.0/zabbix-5.0.3.tar.gz
tar zxvf zabbix-5.0.3.tar.gz
cd zabbix-5.0.3
``` 
环境
``` 
yum -y gcc
yum -y install net-snmp-devel
yum install unixODBC-devel net-snmp-devel libevent-devel libxml2-devel libcurl-devel -y
yum -y install openssl-devel
yum -y install mysql-devel
yum install libxml2 libxml2-devel -y
``` 
用户
``` 
groupadd --system zabbix
useradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c "Zabbix Monitoring System" zabbix
``` 
目录
``` 
mkdir -m u=rwx,g=rwx,o= -p /usr/lib/zabbix
chown zabbix:zabbix /usr/lib/zabbix
mkdir /www/wwwroot/192.168.0.21/zabbix
cd ui
cp -a . /www/wwwroot/192.168.0.21/zabbix
``` 
数据库 
顺序：schema.sql--images.sql---data.sql
``` 
mysql -uzabbix -p
create database zabbix character set utf8 collate utf8_bin;
mysql> use zabbix;
Database changed
mysql> source database/mysql/schema.sql;
mysql> source database/mysql/images.sql;
mysql> source database/mysql/data.sql;
``` 
编译参数
这里用这个配置
``` 
./configure --prefix=$PREFIX --with-mysql --with-net-snmp --with-libcurl --enable-server --enable-agent --enable-proxy
``` 
常用配置：
支持jvm
 --enable-java
 ``` 
./configure --prefix=/usr/local/zabbix --with-mysql --with-net-snmp --with-libcurl --enable-server --enable-agent --enable-proxy --enable-java
``` 
物理服务器传感
--with-openipmi 
``` 
./configure --prefix=/usr/local/zabbix --with-mysql --with-net-snmp --with-libcurl --enable-server --enable-agent --enable-proxy --enable-java --with-openipmi
``` 
配置后config.log查找cannot find关键字
图
``` 
make install
``` 
检查验证安装成功
``` 
/usr/sbin/zabbix_server -V 
ls /usr/sbin/zabbix*
``` 
图
配置

服务配置
``` 
chown zabbix:zabbix -R /usr/local/zabbix/
chmod 744 misc/init.d/tru64/zabbix*
cp misc/init.d/tru64/zabbix_server /etc/init.d/
cp misc/init.d/tru64/zabbix_agentd /etc/init.d/
``` 
开机启动
启动
# 添加启动脚本
cp misc/init.d/fedora/core/zabbix_agentd /etc/init.d/zabbix_agentd
cp misc/init.d/fedora/core/zabbix_server /etc/init.d/zabbix_server
# 修改启动脚本
sed -i "s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix#g" /etc/init.d/zabbix_server
sed -i "s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix#g" /etc/init.d/zabbix_agentd
# 修改zabbix配置文件(/usr/local/zabbix/etc/zabbix_server.conf)
# 添加到开机启动
chmod +x /etc/init.d/zabbix_server
chmod +x /etc/init.d/zabbix_agentd
chkconfig zabbix_server --level 35 on
chkconfig zabbix_agentd --level 35 on

 service zabbix-server start
/etc/init.d/zabbix-server start
启动后端
``` 
service zabbix_server start
service zabbix_agentd start
``` 
**4.安装zabix
访问前端
图
图
图
图
**5.安装主机2:192.168.0.22
``` 
yum install gcc
yum -y install net-snmp-devel
yum install  libevent-devel libcurl-devel -y
yum -y install openssl-devel
yum -y install mysql-devel
yum install libxml2 libxml2-devel -y

 groupadd --system zabbix
useradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c "Zabbix Monitoring System" zabbix
yum install wget
 wget https://cdn.zabbix.com/zabbix/sources/stable/5.0/zabbix-5.0.3.tar.gz
tar zxvf zabbix-5.0.3.tar.gz 
 cd zabbix-5.0.3
 ./configure --enable-agent
make install
``` 
启动配置
``` 
cp misc/init.d/fedora/core/zabbix_agentd /etc/init.d/zabbix_agentd
sed -i "s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix#g" /etc/init.d/zabbix_agentd
chmod +x /etc/init.d/zabbix_agentd
chkconfig zabbix_agentd --level 35 on
``` 
手动操作
``` 
service zabbix_agentd start
/etc/init.d/zabbix_agentd restart
``` 

测试端口：
ping 192.168.0.21
telnet 192.168.0.21 10050

附配置：
``` 
LogType=file
LogFile=/tmp/zabbix_agentd.log
Server=192.168.0.21
ListenPort=10050
ServerActive=192.168.0.21
Hostname=Zabbixserver
``` 
附录：zabbixserver乱码处理